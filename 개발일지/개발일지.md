# 📖✏️Movie Cinema 개발일지

​																																			(기간: 2021.11.17 ~ 11.25)

----



## ▶ **2021.11.17(수)**

### ✔ 오늘의 계획

```
- 전반적인 프로젝트 진행 관련 회의
  - 전체적으로 기획하기
  - 세부 일정 계획하기
  - 프로젝트 컨셉 
    - 크리스마스 테마
    - 크리스마스 관련 영화 추천
  - 아키텍처 결정
    - Django & Vanila JS..?
  - 일정 관련(notion) 정리
  - Model 구상하기
  - ERD (DB 모델 관련)
  - 전체적인 페이지 구성
    - 5개 이상의 URL 및 페이지
    - CSS 탬플릿
  - 영화 정보 Database Seeding 
    - 영화 레코드 50개 이상..
```

### ✔ Create Notion Page

![image-20211117152032867](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211117152032867.png)

### ✔ Time Line 

![image-20211117152118429](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211117152118429.png)



### ✔ Todo List

![image-20211117152146789](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211117152146789.png)



### ✔ 전체적인 웹 페이지 구상하기

![image-20211117152338214](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211117152338214.png)



### ✔ 개략적으로 모델 구성하기(with Excel)

![image-20211117153426491](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211117153426491.png)



### ✔ Ovenapp을 이용한 페이지 구성

![image-20211118004431765](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211118004431765.png)

![image-20211118004737911](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211118004737911.png)

![image-20211118004807781](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211118004807781.png)



### ✔ ERD를 이용한 Model 작성

![img](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/Untitled_Diagram.jpg)



### ✔ 오늘의 고민

```
- Data를 어떻게 Json파일로 잘 가져올 것인가 
- Model의 관계설정 및 구성을 어떻게 할 것인가
- 반응형 웹 템플릿을 사용한다면, 어떻게 활용할 것가 
```



-------



## ▶ 2021.11.18(목)

### ✔ 오늘의 계획

```
- 일정 수정
- 타임라인 수정
- 작업목록 구체화
- ERD 보완하기
- 영화정보 Data 수집해서 DB에 반영하기
- Django 프로젝트 생성 및 세팅, 모델 반영
```



### ✔ Time Line (수정)

![image-20211118101351794](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211118101351794.png)

### ✔ Todo List (수정)

![image-20211118102801596](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211118102801596.png)



### ✔ 개략적인 모델 수정(with Excel)

![image-20211118153428508](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211118153428508.png)



### ✔ ERD 보완 및 수정

![Untitled Diagram (1)](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/Untitled%20Diagram%20(1).jpg)



### ✔ 오늘의 고민

```
- 모델을 수정해 나가고 있는데, 잘 작동했으면 좋겠다!
- 아쉽지만, 무료 템플릿에 우리 프로젝트를 적용하는건 코드 해석 등 어려움이 있어보인다. 패스!
- 역할을 나눠서 좀 더 집중력 있게 프로젝트를 진행할 수 없을까?
- 서로 역할을 나눠서 진행한다면, push pull 하는 과정에서 충돌이 발생하면 어떡하지?
- 테스트 단계에서 django-seed를 활용해보면 어떨까? 음.. fk나 mtn필드가 있으면 생성이 어렵다고 하는데, 테스트 단계에서 db를 gitignore해서 진행하는게 나을까?
```



### ✔ 역할

```
교수님의 조언을 토대로 기능 구현쪽으로 좀 더 투자하는 쪽으로 일정을 수정하였습니다. 
오늘도 전체적인 일정 수정 및 모델 수정 그리고 model작성 쪽으로 함께 진행하였습니다. 
추가로 역할을 나누어 진행한 부분은 다음과 같습니다.
```

-----



## ▶ 2021.11.19(금)

### ✔ 오늘의 계획

```
- 기본적인 기능구현
	- accounts app
	- community app
	- movies app
- 작업목록 실시간 수정하기 
- django-seed 데이터 처리문제 고민하기
```



### ✔ Todo List(수정)

![image-20211119094626853](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119094626853.png)



### ✔ 기능 구현하기 ing... (CSS 없는 페이지)

- 로그인 한 경우, 다음과 같은 서비스들을 이용할 수 있습니다. 

![image-20211119213918755](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119213918755.png)

- 로그인을 하지 않은 경우, 다음과 같은 네브바를 확인할 수 있습니다.

![image-20211119214051774](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119214051774.png)



### ✔ 회원가입 및 로그인 페이지

![image-20211119214204065](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119214204065.png)



### ✔ Community detail 페이지와 Movie detail 페이지

![image-20211119214759859](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119214759859.png)



### ✔ Comment 삭제 수정 기능

![image-20211119224159227](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119224159227.png)

- 자신이 쓴 comment를 삭제버튼, 수정버튼을 눌러서 삭제 및 수정 가능합니다.

- 관리자는 유저가 쓴 글을 삭제할 수 있습니다.

- 관리자는 유저가 쓴 글을 수정할 수는 없습니다. (수정 버튼 렌더링 안되도록 수정함 / 작성자만 수정버튼이 렌더링됨)



### ✔ 오늘의 시행착오

- thumbnail

```
- thumbnail을 추가하기 위해서, django-imagekit을 import 했는데 
  그 과정에서 import오류가 뜨는 것을 확인할 수 있었다.
  해결하기 위해 구글링을 많이 해봤는데, 와닿는 해결방법을 찾기가 어려웠다. 
```

![image-20211119215123285](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211119215123285.png)

```
  도저히 해결이 어려워서 교수님께 여쭤봤더니 이 상태에서도 잘 작동할 수 있다고 하시며
  기능을 작동시켜봤냐고 물어보셨고, 작동시켜봤더니.. 이상없이 잘 작동되는 것이었다..!!
  큰 깨달음을 얻고.. 이대로 진행하기로 했다😂
  그래서 지금도 이렇게 노란줄이 쭉 그어져 있는 상태이다! ㅎㅎ  
```



- gitignore 충돌

```
- 지금 테스트 단계에서 django-seed를 활용해서 데이터를 넣어보기엔 
  우리가 모델에 설정한 MTN과 FK 관련한 처리에 오류가 발생할 수 있어서 
  .gitignore에 각자 db를 따로 만들어서 만들어보면서 진행하기로 했다. 
  
- 1차 시행착오 : 
  gitignore에 #db.sqlite3으로 주석처리 되어있던 db를 주석처리를 풀고 
  ignore하게 만들었다가.. 한명은 db가 있고, 한명은 db가 없다며 충돌이 일어났다..
  
- 2차 시행착오 : 
  리뷰작성 및 프로필 설정에 유저가 이미지 업로드하는 기능이 있는데, 
  그러면 media라는 폴더에 유저가 올린 이미지들이 담기게 된다. 
  각자 push pull을 하려다가 문득, media폴더가 마음에 걸려서 구글링을 해 본 결과,
  media폴더도 따로 ignore할 수 있다는 사실을 알게 되었다. 
  gitignore에서 폴더명 앞에 슬러시(/)를 붙이는 것으로 해당 문제를 해결할 수 있었다. 
```



----



## ▶ 2021.11.20(토)

### ✔ 오늘의 계획

```
- 전반적인 기능 보완 및 수정
- 기본적인 미구현 기능 작성 
	- community 
		- 리뷰 수정 / 삭제, 댓글 수정 / 삭제
    - accounts
    	- profile 페이지 : follow 기능 작성
- url / views 명칭 일부 수정(profile / comment 관련)
```



### ✔ TodoList(수정)

![image-20211121022011740](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121022011740.png)

###✔  Review detail, 수정 / comment 수정 페이지 / Community detail 페이지

![image-20211121023130335](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121023130335.png)

- community의 review 및 comment는 movies와 다르게 관리자 권한이 없어도 생성/수정/삭제가 가능합니다.

- 따라서 관리자 권한이 있으면 작성자가 아니어도 삭제가 가능합니다.



### ✔ accounts > profile 페이지

![image-20211121023434148](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121023434148.png)

### ✔ Community index page

![image-20211121023231540](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121023231540.png)

- 스포일러 유무와 좋아요와 싫어요를 하트 모양으로 구분할 수 있습니다.

- 글 제목을 클릭하는 것으로 글의 상세정보를 조회할 수 있습니다. 



### ✔ 오늘의 시행착오 

```
- 비로그인 사용자가 follow 요청을 보낼때 에러를 발생시켜서 로그인 경로로 이동시키는 작업을 하는데.. 상대경로를 사용하다보니 약간 혼동이 있었다.
- 프로필 기능의 경로는 accounts/profile/<username>인데
  로그인 경로는 accounts/login이다보니... 상대 경로를 다음과 같이 활용하여 
  window.location.href = '../../login/'와 같이 작성해야 함을 알았다. (아직 사용법이 헷갈린다)
```



### ✔ 오늘의 고민

```
- 그렇게 많은 기능과 데이터를 넣지 않았다고 생각했음에도 불구하고 
  기능과 가지고 있는 데이터를 어떻게 어느 화면에서 보여줘야 적절할지에 대한 고민이 많이 들었다.
- 페이지에서 렌더링하는 데이터를 context에 담을때 어떻게 처리해야 적절할지 고민이 있었다. 
  예를 들면 review를 수정하는 페이지에서 어떤 리뷰, 영화에 대한 수정인지를 보여주고 싶은데,
  review데이터 전체를 가져오는 방법도 있지만 불필요한 데이터를 너무 많이 담는 것이 적절하지 않은 것 같은 느낌이 들어서 title과 movie정보만 가져오도록 context에 처리했는데 실제로도 적절한지 판단하기가 힘들었다.
  참조/역참조 부분도 view단에서 처리하는 부분과 template단에서 처리하는 부분에 혼동이 다소 있었다. 
  또한 이런 부분들을 일관성있게 처리하는 것이 다소 어렵다고 느꼈다. 
- 권한 관련해서 생각이 좀 있었는데, 글쓰기/수정/삭제/ 프로필 조회 등 기본적인 권한을 어떻게 부여하는지에 대한  고민도 있었고, 
  현재는 관리자 프로필 조회나 영화정보 등록 등 권한이 없는 사용자에 대해서 movies 메인페이지나, 
  요청을 보낸 디테일페이지로 redirect하도록 처리를 하고 있는데 실은 이보다는 권한 없음에 대한 에러메시지를 띄우고 
  요청을 보내기 전 이전 페이지로 보내는 방법에 대해서 고민해보다가
  아무래도 자바스크립트 쪽을 활용하면 좀 더 적절하게 구현이 될 것 같기는 한데 다소 어렵게 느껴져서,
  django에서 활용할 수 있는 관련 messages(from django.contrib import messages 를 활용하는 방법) 기능을 찾아보기는 했다. 
  또한 이전 경로로 리다이렉트하려면 미리 이전 경로를 저장하는 과정을 거쳐야 하는 것 같은데....? 
  아직 전체적인 기능 구현이 조금 미흡한 것 같아 시간 관계상 나중에 고민하는 것으로 미뤘다.
- 프로필페이지에서 렌더링하는 데이터가 다소 많은 것 같고, 아직 비동기요청을 적절히 활용하는 것이 익숙치 않아서
  현재는 팔로우 버튼을 눌러도 팔로워 리스트에 바로 반영이 되지 않고 있다. 팔로우 페이지를 별도의 페이지로 구성해서 
  a링크로 보내거나(기능 자체는 단순하지만.. 페이지가 또 늘어나게 된다😥) 비동기 요청 기능을 반영해야할 것 같다.
- 이미 form 부분을 포함한 template이 많고, 태그도 많아졌는데, 더 반영하고 싶은 기능도 있는데.. 
  기능도 기능이지만 front단도 무시할 수 없는 부분인데 전체적으로 어떻게 일관성있고 심미적으로 편리하게 가공할지에 대해 고민과 시간이 많이 필요하다고 느꼈다.
```



## ▶ 2021.11.21(일)

### ✔ 오늘의 계획

```
- tmdb data 제대로 이해하고 활용하기 
	- data 입력 및 test 작업
- 좀 더 구현하고 보완할 기능이 없는지 기능적인 측면에서 확인하기
	- profile 페이지 보완 / follow_list 보완
	- movies scrap 기능 보완
	- community like / dislike 기능 반영
	- movies detail 기능 보완(해당 영화에 작성된 리뷰 일부 보이도록)
```



### ✔ tmdb 활용법 공부하기

- 대표적인 참고 형태는 다음과 같습니다. 

```python
#기본적인 예시
    https://api.themoviedb.org/3/movie/76341
    ?
    api_key=2b9202131819cc06c64543e81267021d
    &
    language=ko
    &
    region=KR
```

- results에서 주로 movie_id값이 가장 중요합니다 

- 그 이유는 required한 params로 movie_id가 많이 쓰이기 때문입니다.



### ✔ Profile page 

![image-20211121160441910](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121160441910.png)

- follower와 following을 클릭하면, 각각 팔로워와 팔로잉하는 유저의 명단을 확인할 수 있습니다.

- 확인된 명단의 유저 아이디를 클릭하면, 그 유저의 profile page로 이동 가능합니다. 

- admin 관리자도 회원을 follow 할 수 있고, 명단에서 확인도 가능하지만, 

  클릭했을 때, admin의 profile page는 확인할 수 없게 처리했습니다. 



### ✔ New movie

![image-20211121160657857](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121160657857.png)

- 일반 유저인 test의 navbar에서는 New Movie라는 배너를 찾아볼 수 없습니다. 

![image-20211121160741784](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121160741784.png)

- 하지만, 관리자인 admin은 새로운 영화를 등록할 권한이 주어집니다. 
- 따라서 admin의 navbar에서만 New Movie라는 배너를 확인해 볼 수 있습니다. 

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121160943188.png" alt="image-20211121160943188" style="zoom: 80%;" />

- 테스트 단계인 지금, New movie창에서 다음과 같이 관리자가 직접 영화를 등록할 수 있습니다. 

  (추후, api를 통해서영화를 등록할 수 있게 처리할 예정)

- 장르는 MTN관계로 설정해 놨으므로, 여러 장르를 선택할 수 있습니다. 



### ✔ Movie detail

- 특정 영화 detail 페이지에 오면, 해당 영화에 달린 다른 리뷰들의 목록을 확인해볼 수 있습니다. 

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211121161607008.png" alt="image-20211121161607008" style="zoom:80%;" />

### ✔ Community detail

- 아래와 같이 리뷰 작성 페이지를 들어가는 경로에 따라 영화 제목 표시 유무 및 movie를 선택할 수 있는지 유무를 다르게 설정했습니다.

![](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122002615475.png)

- poster와 youtube는 src에서 사이트를 좀 더 명시적으로 작성했기 때문에 영화 데이터를 등록할때 좀 더 짧은 주소(id값에 해당하는 부분)로 등록할 수 있게 코드를 수정했습니다. 

```python
# 포스터
<img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" alt="{{ movie.title }}_poster" width="300px">

# 유튜브
<iframe width="560" height="315" src="https://www.youtube.com/embed{{ movie.youtube_path }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
```



### ✔ 영화 스크랩 기능 구현

- Javascript의 axios 요청을 통해서 비동기적으로 새로고침 없이도 스크랩 적용 및 취소 기능이 실행되고 innertext를 통해 스크랩된 개수가 반영되도록 적용했습니다.
- 폰트어썸 cdn 적용 및 class 적용을 통해 스크랩을 한 경우 채워진 별 / 안된 경우 빈 별로 표시되도록 했습니다. 

![image-20211122003009282](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122003009282.png)

### ✔ 리뷰 좋아요 / 싫어요 기능 구현

- 좋아요 / 싫어요를 반영하는 필드가 별개의 필드이다보니 두개를 동시에 누를 수 있는 경우가 발생했습니다.
  - 두개의 기능이 동시에 실행되는 것은 다소 모순적인 것 같아서 이미 반대의 기능을 실행한 경우 이미 실행된 기능은 취소가 되도록 view 함수를 수정했고 버튼에 비동기적으로 상태를 반영하는 자바스크립트 코드도 해당 부분이 반영되도록 수정했습니다. 
  - 하트 아이콘으로 하고 싶었는데 싫어요를 표시하는 깨진 하트 아이콘이 유료라서 불가피하게 뒤집어진 엄지손가락 아이콘으로 표시했습니다.😥
  - 프로필 페이지에서도 목록이 반영되도록 했으며, 제목을 누르면 해당 영화 / 리뷰로 이동하도록 작성했습니다.



![image-20211122005708417](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122005708417.png)(좋아요 / 싫어요 버튼을 동시에 누를 수 있는 상태)

![image-20211122003037972](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122003037972.png)(동시에 실행될 수는 없도록 수정했음!)



### ✔  좋아요와 싫어요 동시에 No!

![image-20211122010025190](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122010025190.png)

- 좋아요한 리뷰의 a태그에 href 부분에 오타가 있는 것이 발견되어서 수정했음!



### ✔ 오늘의 시행착오 

```
- javascript로 movie scrap, review like/dislike 기능을 비동기적으로 반영되도록 수정하는 부분에서 오타로 인한 시행착오가 많았다.
- 특히 충격과 공포였던 부분은 scrap 기능의 url 경로를 작성할때 실수로 마지막 '/'를 작성하지 않은 것을 미처 발견하지 못하고, 
  axios요청은 마지막 '/'를 붙인 주소로 보내는 바람에 계속 404에러만을 발생시키는 것을 1시간 반동안 하염없이 찾아야만 했다.😱
- 자바스크립트 코드 내의 변수 등과 관련된 오타가 아니었다보니 콘솔창에서도 404에러 외의 힌트가 없어 찾기가 쉽지 않았다. 
  특히나 require_post 데코레이터를 주석처리하고 주소창에서 get요청으로 보냈을 때는 적절한 응답이 발생하는 것을 확인할 수 있었기 때문에 
  더욱 url에 이상이 있는 점을 찾기가 어려웠다. 단 한 글자의 실수로 인해 많은 시간을 쓸 수 있음을 오늘도 시행착오를 통해 체험했다.
```



### ✔ 오늘의 고민

```
- javascript나 view함수 부분에서 똑같은 코드의 중복(특히 like/dislike를 반영하는 부분)이 많이 발생해서 중복을 줄여야 한다는 필요성을 느꼈으나
  일단 시간 관계상 기능 구현을 우선으로 진행했다. 시간이 한정된 프로젝트라는 것이 쉽지 않다는 것을 절실히 깨닫는 순간이었다..
- 마찬가지로 한정된 시간 안에 기능 구현을 우선으로 하다보니 view함수 부분에서 query 최적화를 고려하지 못하고 일단 데이터를 가져오는 식으로 작성을 하는 경우가 많아서, 
  비효율적인 데이터베이스 사용이 아닌지 고민이 있었다.
- 데이터 수집 관련된 부분이 예상보다 더 쉽지 않아서 어떻게 수집을 해야 할지 고민이 많이 된다.😭
- tmdb data 50개를 가져와서 실시간으로 연동되게 구현하고 싶었다. 그래서 이런저런 코드들을 많이 참조하고 유튜브도 보고, 블로그도 보고, 
  다른사람의 코드를 보며 공부하면서 시도를 했는데.. 역시 남의 코드를 활용하는 것도 실력이 뒷받침되야 한다는 것을 실감했다 ㅠㅠ 
  뭔가 이해되지 않는 오류들 투성이었다.. 그래서 결국 fail..😭😭
```

---



## ▶ 2021.11.22(월)

### ✔ 오늘의 계획

```
- front : 전체적인 페이지 구성 계획
- Community/review_index 페이지네이터 기능 구현하기
- Movies/movie_index 인피니티스크롤
- Accounts/Allauth(*)
- 영화 Data 수집(가져오는 법) - TMDB활용하기
- TMDB 활용해서 genres data 가져오기 / movie_data 가져오기 -> json파일로 변환하기
- youtube path data 수집
- 반응형 web template 분석하고 적용할 수 있는지 공부하기
```



### ✔ Todo List

![image-20211122195715202](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122195715202.png)



### ✔ tmdb를 연동해서 데이터 추가하기

```python
# tmdb.py

 # 1페이지부터 10페이지까지 (페이지당 20개, 총 200개)
    for i in range(1, 11):
        request_url = f'https://api.themoviedb.org/3/movie/popular?api_key={TMDB_API_KEY}&language=ko-KR&page={i}'
        video_url_1 = f'https://api.themoviedb.org/3/movie/'
        video_url_2 = f'/videos?api_key={TMDB_API_KEY}&language=ko-KR'
        movies = requests.get(request_url).json()
```

- 처음에는 2000개 정도 데이터를 가져오게 했다가 서버가 너무 느려져서 ㅠㅠ 200개 정도의 데이터를 가져오게끔 구현했습니다. 

- 서버에 데이터 저장해주기

```bash
python manage.py loaddata genre_data.json
python manage.py loaddata movie_data.json
```

![image-20211122214356057](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122214356057.png)

![image-20211122214518508](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122214518508.png)

- 장르와 무비 데이터 가져온 모습



### ✔ 메인페이지

![image-20211122210605362](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122210605362.png)

- base.html에서 컨테이너를 추가해서 가운데로 정렬되어 보이게끔 만들었습니다. 

```html
# base.html
<div class="container">
</div>
```



### ✔ 회원가입 기능(닉네임필수)

![image-20211122210919645](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122210919645.png)

- 닉네임을 입력하지 않으면 회원가입을 할 수 없게 만들었습니다. 
- 리뷰 작성 및 댓글을 남길 때, 유저들이 닉네임으로 확인될 수 있게 하고싶었습니다. 
- 또한, 회원가입 직후 바로 프로필 페이지로 이동하게끔 처리했습니다. 

![image-20211122211233873](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122211233873.png)

- 또한, 회원가입할 때, profile image를 삽입할 수 있게 만들었는데, 프로필 이미지를 넣지 않을 경우, 기본이미지가 보이게끔 처리를 했습니다. 
- 기본이미지는 static 파일을 이용해서 처리했습니다. 

```python
# settings.py
STATIC_URL = '/static/'
```



### ✔ 구글로그인 연동

![image-20211122211115322](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122211115322.png)

- bootstrap을 통해 버튼 칼라를 설정해주었습니다. 
- 초록색 구글로그인 버튼을 누르면, 구글 계정을 연동할 수 있게 처리했습니다. 

![image-20211122211441466](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122211441466.png)

- 다음과 같이 구글로그인을 할 수 있습니다. 

- 구글로그인 설정을 위해 admin페이지에서 작업을 해주었습니다. 

![image-20211122211930501](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122211930501.png)



### ✔ 리뷰페이지 글이 없을때

![image-20211122214727626](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122214727626.png)



- 리뷰를 작성해주세요 라는 글이 뜨게 처리했습니다!



### ✔ 리뷰페이지 이미지 업로드(이미지업로드 유무)

> 사용자가 이미지를 직접 업로드하면, 그 이미지가 썸네일로 보이게 하고,

![image-20211122215220207](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122215220207.png)



> 이미지를 업로드 하지 않는경우, 썸네일에 해당영화의 포스터가 기본이미지로 보이게 구현하였습니다.

![image-20211122215423776](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122215423776.png)





### ✔ 인피니티 스크롤 구현하기

![image-20211122220948020](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122220948020.png)

```python
@require_safe
def index(request): # 인피니티 스크롤 기능 반영
    movies = Movie.objects.order_by('-popularity')
    # print(len(movies))
    paginator = Paginator(movies, 20) # 20개씩 잘라서 가져오기
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)
    # print(len(page_obj))

    # /movies/?page=2 ajax 요청 => json
    if request.headers.get('x-requested-with') == 'XMLHttpRequest':
        data = serializers.serialize('json', page_obj)
        return HttpResponse(data, content_type='application/json')
    # /movies/ 첫번째 페이지 요청 => html
    else:
        context = {
            'movies': page_obj,
        }
        return render(request, 'movies/index.html', context)
```

- 200개의 영화 데이터이다보니 한 화면에 보여주는 것은 적절하지 않고, 페이지네이터로 화면을 넘기는 것도 좋지만, 게시판보다는 정보성 페이지이기 때문에  pjt09 라이브 수업 시간에 배운 paginator와 serializers, HttpResponse 기능 및 자바스크립트를 활용한 인피니티 스크롤 기능을 적용해보면 적절하지 않을까 싶어서 해당 기능을 적용해보았습니다.
- 구글 이미지 검색을 비롯한 여러 사이트에서 많이 접했던 기능인데 이런 기능은 javascript의 axios 기능을 통해 동적으로 페이지를 구성할 수 있다는 점을 배울 수 있었습니다.
- 마지막 페이지에 도달했을때 마지막 페이지가 반복해서 로딩되는 부분을 수정해보려 했으나 (마지막 페이지인 경우 페이지를 다시 로딩하지 않도록..) 조건문을 통해 몇가지 방법을 시도해보았으나 javascript가 아직 익숙치 않은 탓인지 실패했습니다.😥



### ✔ 페이지네이터 구현하기

![image-20211122221124867](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122221124867.png)

- 커뮤니티의 게시판이다보니 한 페이지에 전부 불러오는 것은 적절하지 않고, 페이지를 나눠서 해당 페이지에 직접 접근도 할 수 있도록 할 수 있도록 페이지네이터 기능을 사용하여 community index 페이지를 수정했습니다.
- 인피니티 스크롤과 마찬가지로 django에 이미 Paginator 내장 기능이 있어서 활용할 수 있는 점이 최고!👍👍👍



### ✔ web template 적용하기 공부

![image-20211122215858658](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122215858658.png)

- 다음 4가지 사항만 잘 적용시켜주면, django와 web template을 잘 적용시킬 수 있습니다. 

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211122215927234.png" alt="image-20211122215927234" style="zoom:67%;" />

- 아직 이미지를 전부 다 static태그로 바꾸지 않아서 이미지가 안나오는 부분들이 있는데, 
- 다음과 같은 템플릿에 적용하기 위해서 오늘 이런저런 실험을 해보았습니다. 

- css파일 및 img파일들을 django가 위치를 잘 찾게만 해주면 잘 작동되는 것을 확인할 수 있었습니다. 



### ✔ 오늘의 시행착오

```
- 반응형 Web 템플릿을 너무 적용하고 싶어서, 여러번 시도를 해봤었다. 
  그 중, css 파일 img파일, js파일, fonts 파일 등을 django가 읽게 만드는 과정이 잘 되지 않았다. 
  이 부분을 잘 해내려면 2가지 사실을 알고 해결해야 했다. 
	1-1. css, fonts, img, js 등의 파일이 static파일이라는 사실을 알고 django의 settings.py에 가서 STATICFILES_DIRS = [BASE_DIR / 'static',] 과 같은 처리를 해주고
	1-2. BASE_DIR인 최상위의 폴더 아래 static 폴더를 만들어서 각 파일들을 넣어줘야 한다. 
	2. 각 css, fonts,img,js를 적용할 html파일에 가서 load static을 한 후, static dtl을 활용해서 static태그 처리를 해주어야 했다.
- data를 가져오는데 pjt02때 배웠던 코드를 활용해서 가져오려고 했는데, 그것만 활용해서는 수기로 작성하는 과정이 필요했다. 
  자동 연동을 하고싶어서 코드 참조를 하려고 여러 코드를 보는데 os.getenv로 다들 TMDB_API_KEY를 가져오는 것이었다. 
  이 부분이 너무 이해가 안되서 구글링을 많이 해봤지만 이해하기 힘들었고, 결국 오늘 교수님께 여쭤보는 것으로 의문을 해소할 수 있었다!
  내 컴퓨터에 private한 키를 입력해서 가져오게끔 하는 코드! 이부분을 이해하니까 다른부분은 쉽게 이해할 수 있었다. 
```



### ✔ 오늘의 고민

```
- front를 어떻게 구성할지 가장 고민이었다. bootstrap을 이용해서 꾸미는 방법도 있지만, 
  뭔가 반응형 web template을 활용해서 꾸며보고 싶었다. 
  하지만 걱정되는 부분이 많이 있었다. 정해진 정적인 img나 데이터들은 적용하기 쉽지만 
  실시간 연동을 통한 사이트에서는 어려운 템플릿 코드를 분석해서 적용하기가 어려워보였다..!! 
  만약 템플릿을 적용한다면 어떤 템플릿이 좋을지도 고민이다!! front는 고민의 연속이다😫
- Data에 대한 고민이 많았다. 수기로 직접 입력하는 방법도 있었는데 그 방법은 시간상 효율상 나쁘지 않다. 
  하지만,데이터를 실시간으로 자동 연동하면 더 완성도 있는 프로젝트가 될 것 같아서 욕심이 났었다.
  결국 genres 데이터를 쭉 가져오고, json형식으로 변환해주고, 
  movie_data 데이터도 쭉 가져오고, json형식으로 변환해주는것으로 tmdb에서 데이터 가져오기에 성공하였다!! 뿌듯😊
```



---

### ▶ 2021.11.23(화)

### ✔ 오늘의 계획

```
- 메인페이지 front 디자인
- accounts front 디자인
- movies front 디자인
- 영화 추천기능 구현
```



### ✔ Todo List

![image-20211123092054971](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211123092054971.png)



### ✔ 영화 추천 알고리즘 보완하기

```python
@require_safe
def recommended(request):

    def real_random_movies(): # 가지고 있는 데이터 중에서 랜덤으로 10개 보여주는 함수
        movies = Movie.objects.all()
        random_nums = random.sample(range(0, len(movies)), 10)
        for i in random_nums:

            ...
    
    else: # 로그인 했고 스크랩한 영화가 있을 때
        try: # tmdb 요청시 에러 발생시
            random_num = random.randrange(0, request.user.scrap_movies.all().count()) # 스크랩한 영화의 인덱스 중에서 한개를 랜덤하게 가져온다
            random_movie_id = request.user.scrap_movies.all()[random_num].pk # 랜덤으로 가져온 인덱스 번호의 pk를 추출한다
            request_url = f'https://api.themoviedb.org/3/movie/{random_movie_id}/recommendations?api_key={API키}&language=ko' # tmdb로 추천 영화 요청을 보낸다
            random_movies_info = requests.get(request_url).json()

            if random_movies_info['results']: # tmdb로 받은 추천 영화 데이터의 결과가 비어있지 않은 값이면
                random_movies = random_movies_info['results'] # tmdb 기준 추천 영화를 보여준다
                tmdb_base = True
            else: # tmdb 추천영화가 없을 때(results가 비어있을 때)
                real_random_movies() # db 데이터에서 랜덤으로 10개 보여준다
        except: # 에러 발생시 
            real_random_movies() # db 데이터에서 랜덤으로 10개 보여준다

    context = {
        'random_movies': random_movies,
        'tmdb_base': tmdb_base
    }
    return render(request, 'movies/recommended.html', context)
```

- 로그인을 했을 때는 스크랩한 영화를 기준으로 랜덤으로 한개를 골라 tmdb에서 해당 영화를 기준으로 추천해주는 영화를 가져와 추천하도록 했습니다.
- 비로그인시 / 스크랩한 데이터가 없을 시, tmdb에 보낸 요청이 응답에 실패했을 때는 기존에 구현했던 알고리즘대로 데이터베이스에서 10개를 랜덤으로 추천해주는 기능을 사용합니다.



### ✔ 영화추천 (로그인/비로그인)

![image-20211124012236187](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124012236187.png)

- 비로그인한 회원의 경우, 무작위 영화 10개가 추천됩니다. 

![image-20211124012501379](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124012501379.png)

- 로그인을 하더라도, 스크랩한 영화가 없는 경우, 랜덤으로 추천되고 랜덤이라는 문구가 띄워집니다.

![image-20211124012547234](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124012547234.png)

- 영화 스크랩을 하고 나니, 스크랩한 영화를 기반으로 추천됐다는 문구가 띄워집니다. 

- 이렇게 상황별로 다른 알고리즘을 추천하는 서비스 기능을 구현하였습니다. 



### ✔ form 부분 스타일링 적용(django-bootstrap-v5)

![image-20211123203237369](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211123203237369.png)

![image-20211123204955043](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211123204955043.png)

- django-bootstrap을 install하여 기능을 활용해 전체적인 form을 수정했습니다.

- 영화 한줄평 / 리뷰 댓글을  수정하는 부분에서는 기본 폼 스타일링이 너무 길게 표시되고 라벨이 content로 표시되는 부분이 적절하지 않은 것 같아 forms.py에서 아래와 같이 form 설정을 추가해 주었습니다.

  ```python
  content = forms.CharField(
      label="댓글",
      widget=forms.Textarea(
          attrs={
              'class': 'my-content form-control',
              'placeholder': '댓글 작성하기',
              'rows': 3,
          }
      )
  )
  ```

  - 다른 form도 label이 model에서 지정한 필드명 그대로 출력되는 부분을 label지정을 통해 수정을 해주는 것이 사용자 편의상 나을 것 같다는 생각을 했으나,  필드가 content뿐인 댓글에 비하여, 설정해줘야하는 필드와 고려해야하는 부분이 많기 때문에 시간관계상 일단 보류했습니다.




### ✔ Movie List / Recommendation : front 페이지 구성 수정

![image-20211124000132309](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124000132309.png)

- Movie list(index) 수정 과정 중 인피니트스크롤(자바스크립트) 부분에 부트스트랩 반영이 잘 되지 않아 어려움이 있었습니다. div 위치와 for문 위치 때문에 클래스가 적절히 적용이 되지 않았던 것이 발견되어 시행착오 끝에 해결은 했으나.. 비로그인 시에는 문제없이 출력이 되는데 movie list화면에서 로그인시 a태그가 생겨 한개의 영화가 밀려서 출력되는 부분은 아직 해결이 되지 않았습니다.



### ✔ front template 고민하기

![image-20211124005213463](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124005213463.png)

- 이 템플릿으로 프로젝트를 진행하고 싶어서, 코드를 분석하고 적용하려고 했습니다. 
- 그런데, 이 템플릿에는 치명적인 단점이 있었습니다 

```html
<!-- index.html -->
<div class="page"><a class="section section-banner" href="https://www.templatemonster.com/intense-multipurpose-html-template.html" target="_blank" style="background-image: url(images/background-02-1920x60.jpg); background-image: -webkit-image-set( url(images/background-02-1920x60.jpg) 1x, url(images/background-02-3840x120.jpg) 2x )"><img src="images/foreground-02-1600x60.png" srcset="images/foreground-02-1600x60.png 1x, images/foreground-02-3200x120.png 2x" alt="" width="1600" height="310"></a>
```

- 아래 코드에서 style속성이 inline형태로 써져있는 것을 확인할 수 있었습니다. 
- 그래서 inline인 style속성을 style태그 혹은 css파일에 옮겨서 진행해보려고 시도를 해봤는데, 이해하기 어려운 -webkit-image-set 부분도 조금 어려웠고 모든 style속성을 찾아서 바꾸는건 비효율적이기도 하지만 바꿔보았지만 오류가 났습니다 ㅠㅠ .. 그래서 이 템플릿은 포기!



- 그래서 어제 분석해봤던 템플릿으로 다시 진행해보았습니다. 

- 우선, 배경화면을 정하는 데에 고민이 많았습니다. 

![image-20211124010144774](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010144774.png)

- 수많은 후보들을 제치고 고른것은 바로 가장 깔끔한 어두운 벽돌 배경이었습니다. 

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010202982.png" alt="image-20211124010202982" style="zoom:67%;" />



### ✔ 벌써부터 광고 고민~?

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010250946.png" alt="image-20211124010250946" style="zoom:80%;" />

- 오른쪽에 배너가 있었는데, 광고 사진이 들어있었습니다. 
- 광고사진 대신 영화를 더 넣어서 8개로 맞출까 하다가, 광고를 넣는 느낌으로 진행해보는 것도 좋다고 생각이 들어서 SSAFY관련 사진을 넣어봤습니다! 클릭하면 광고주님의 홈페이지로 이동할 수 있도록 구현해보겠습니다..!!!



### ✔ Preloader

- 진행하던 프로젝트에 front를 합치려다보니, 생각보다 많은 오류들에 괴로웠습니다 ㅠㅠ
- 그 중 가장 멘붕이었던 오류는 바로, preloader입니다. 

![image-20211124010534634](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010534634.png)

- 실제로 위와 같은 그림이 몇분동안 계속 ... 나오는 바람에 너무 걱정이 됐습니다. 
- 도대체 뭐가 문제지 하고 찾아보다가 오류페이지에서 확인할 수 있었습니다. 

![image-20211124010617182](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010617182.png)

- 위의 오류는... 다른거지만 이 때, preloader오류도 함께 발견했습니다. 

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010639571.png" alt="image-20211124010639571" style="zoom:50%;" />

- 그래서 preloader가 어떤것인지 살짝 공부해본 후, 중복해서 정한 load를 삭제하는 것으로 오류를 해결할 수 있었습니다. 

- 그 중, 가장 많은 답변이 

![image-20211124010731184](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124010731184.png)

- min.js 파일에서 제일 아래에 있는 다음과 같은 코드를 삭제하는 것이었습니다. 



### ✔ 검색기능 구현

![image-20211124024748406](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124024748406.png)

- '베'로 입력한 결과입니다. 
- 제목에 들어가는 글자가 한 글자라도 포함되면 검색되게 구현했습니다. 

![image-20211124033902477](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124033902477.png)

- 결과가 존재하지 않는 경우 다음과 같이 표시됩니다.

### ✔ 메인페이지 수정

<img src="%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124042502590.png" alt="image-20211124042502590" style="zoom:80%;" />

- static한 데이터랑 잘 연동이 안되서 아직 스파이더맨 사진이지만, 이터널스 사진으로 교체하였습니다. TOP3 정도만 선정해서 할 예정입니다.
- 원래 가운데 정렬이 되있어서 보기 조금 아쉬웠는데, base.html의 container을 제거해서 해결하였습니다. 



### ✔ 오늘의 시행착오

```
- 진행하던 프로젝트와 front template을 합치는 과정에서 해결하기 어려운 오류를 만나, 
모든 프로젝트 파일을 초기화해서 다시 push하여 진행하게 되었다 ㅠㅠ😥
- 하필 style속성으로 만들어진.. 템플릿을 골라서 수정하느라 시간도 오래걸리고 결국 성공하지 못해서 넘나 슬펐다ㅠㅠ 예전에 강의에서 style속성은.. 상어 같은 존재라고 하셨던것 같은데... 흑..
- preloader라는 걸... 실수로 중복 사용하면 무한루프 돈다는 사실을 알았다... 아까의 멘붕이란😫
```



### ✔ 오늘의 고민

```
- 좀 더 효율적으로 form을 꾸밀 수 없을까 고민끝에 django bootstrap을 활용하였는데, 
깔끔하고 예뻐서 만족스럽다!😊
- template을 다른 html에도 적용하고 싶었는데, 고려해야 될 부분이 많아서 그냥 index만 template을 활용하기로 했다!
- 알고리즘을 어떻게 구현할 수 있을까 많이 고민됐는데, tmdb의 recommendations를 이용해서 구현했는데, 스크랩한 영화들을 기반으로 추천하는 알고리즘! 맘에 든다 😁
```



---

### ▶ 2021.11.24(수)

### ✔ 오늘의 계획

```
- Front 집중 보완
	- 전체적인 수정(글씨색 / 버튼 등)
	- 네비게이션 바 배치 수정
	- footer 추가
	- account
		- profile 페이지
        - follow-list 페이지
    - movies
	    - main 페이지 수정(movie index)
    	- search (페이지네이터 기능 삭제)
    	- detail 페이지
    - community
    	- index (페이지네이터 _ 페이지 넘기는 버튼 추가)
    	- detail 페이지
```

### ✔ Todo List

![image-20211124095348411](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124095348411.png)

### ✔ 네브바 배치 수정

![image-20211124212055362](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124212055362.png)



### ✔ Community index페이지 페이지네이터

![image-20211124212145342](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124212145342.png)

![image-20211124212313652](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124212313652.png)

- 예쁘게 잘 구현해보려고 여러 시도를 해봤는데 생각보다 마음에 딱 드는 기능을 구현하기란 어려웠습니다



### ✔ JS충돌 오류 수정

- extends와 include를 이용해서 한 개의 페이지를 두개로 나누려다가, js코드들이 중복으로 충돌하는 상황이 발생했습니다. 

- 그 때문에... 페이지가 엄청 깨져서 보이는 대 혼란을 겪었습니다.
- 페이지를 include를 이용하지 않고, 제대로 나누는 것으로 문제를 해결하였습니다. 



### ✔ 로그인만 하면 페이지가 깨져~

- 코드에 없는 a태그가 서버를 실행시키면, 자꾸 자동으로 코드 중간에 생성되었습니다. 생성뿐만 아니라, index페이지가 깨져서 보였습니다. a태그가 왜 자동으로 생성되는지 알아보니까, 브라우저가 자신을 보호하기 위한 행동이라는둥.... 여러 글을 읽어보았지만 딱히 마음에 드는 해결책을 찾을 수 없어서 코드를 다시 처음부터 찬찬히 보기 시작했습니다. 알고보니.. `base.html`에서 include하여 사용하는 `nav.html`에 profile로 이동하는 링크에 닫는 `</a>`태그가 아닌 `<a>` 태그가 작성되어있었던 것이 전체의 템플릿에 영향을 준 문제였습니다.🤣 



### ✔ Top9 tmdb데이터 index 페이지에 적용

![image-20211124212921743](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124212921743.png)

- 어제까지 그냥 static한 사진을 활용했지만 
- 오늘은 tmdb사이트에서 인기있는 영화들을 반영했습니다! 

- 이미지 뿐 아니라, 제목, 인기도, 평점, 개봉일, 내용, 유튜브링크 등을 가져왔습니다!

```html
<!-- 제목 -->
<h2 class="fw-bold">{{ popular_movies.1.title }}</h2>
<!-- 이미지 -->
<img src="https://image.tmdb.org/t/p/w1280{{ popular_movies.1.poster_path }}" alt="{{ movie.title }}_poster" />

<!-- 유튜브 -->
<a class="theme-btn theme-btn" href="https://www.youtube.com/watch?v={{ popular_movies.1.youtube_path }}"><i class="icofont icofont-play popup-youtube"></i> Play </a>

<!-- 그 외, -->
<h4>👑 인기 2위 ({{ popular_movies.1.popularity }})</h4>
<p class="fs-6">평점 : {{ popular_movies.1.vote_average }}</p> 
<p class="fs-6">개봉일 : {{ popular_movies.1.release_date }}</p> 
<p>{{ popular_movies.1.overview | truncatewords:70 }}</p>
```



### ✔ 이미지 화질 upup

![image-20211124213047682](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211124213047682.png)

- 원래 w200으로 이미지를 가져왔습니다.

```
<img src="https://image.tmdb.org/t/p/w200{{ popular_movies.1.poster_path }}" alt="{{ movie.title }}_poster" />
```

- 화질을 올리기 위해, 1280으로 변경해주어 고화질의 이미지를 가져올 수 있었습니다.

```
<img src="https://image.tmdb.org/t/p/w1280{{ popular_movies.1.poster_path }}" alt="{{ movie.title }}_poster" />
```



### ✔ 템플릿 깎는 노인👵

![image-20211125011959620](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125011959620.png)

![image-20211125012026552](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125012026552.png)

- 어제는 form 부분을 집중적으로 수정했다면 오늘은 navbar를 전체적으로 수정하고 footer를 추가했습니다. accounts : profile, follow / movie index, detail 페이지 / review index, detail 페이지를 수정했습니다.

![image-20211125012436292](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125012436292.png)

- 링크 처리(게시글 링크 / 유저 프로필 링크)가 적절히 반영될 수 있도록 유의해서 구현했습니다.

![image-20211125012324132](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125012324132.png)

- 어제자로 적용한 card 컴포넌트 부분은 적용되는 페이지마다 일관성있게 반영하기 위해 부트스트랩 class를 조정했습니다.



### ✔ movies detail(세부 영화정보) _ 유저(리뷰어) 평점 데이터 추가

- 기존에 고려만 해 두었던 기능을 추가했습니다. tmdb 평점 뿐만 아니라 유저의 리뷰에서 가져온 평균 평점 정보를 view함수에서 추가했습니다. annotate를 통해 필드를 설정했으면 어떨까 싶기는 했는데 단순한 기능이라 그냥 aggregate를 통해서만 반영했습니다.
- 리뷰 데이터가 없어 평균값이 None일 때는 ''리뷰 데이터가 없습니다''를 표시하도록 했습니다.

![image-20211125094349016](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125094349016.png)

- views.py

```python
@require_safe
def detail(request, movie_pk):
    movie = get_object_or_404(Movie, pk=movie_pk)
    comment_form = CommentForm()
    comments = movie.comment_set.all()
    reviews = movie.reviews.all()[:5] # 영화에 달린 리뷰 정보 5개 보냄
    reviewer_rank = movie.reviews.all().aggregate(Avg('rank'))['rank__avg'] # 리뷰어 평점 추가
    reviewer_count = movie.reviews.all().count() # 리뷰어 수 추가
    
    context = {
        'movie': movie,
        'comment_form': comment_form,
        'comments': comments,
        'reviews': reviews,
        'reviewer_rank': reviewer_rank,
        'reviewer_count': reviewer_count,
    }
    return render(request, 'movies/detail.html', context)
```

- movie / detail.html

```html
  <div class="row">
    <div class="col">
      <img src="https://image.tmdb.org/t/p/w1280{{ movie.poster_path }}" alt="{{ movie.title }}_poster" width="680px">
    </div>
    <div class="col my-2 text-white fs-6">
      <p class="mb-2">개봉일: {{ movie.release_date }}</p>
      <p class="mb-2">Popularity: {{ movie.popularity }}</p>
      <p class="mb-2">장르: {% for genre in movie.genres.all %}{% if forloop.last %}{{ genre.name }} {% else %} {{ genre.name }}, {% endif %} {% endfor %}</p>  <!-- 마지막 장르 데이터에는 ',' 붙이지 않도록...-->
      <p class="mb-2">줄거리: {{ movie.overview }}</p>
      <p class="mb-2">TMDB 평점: {{ movie.vote_average }}</p>
      <p class="mb-2">TMDB 평점 참여자수: {{ movie.vote_count }}</p>
      {% if reviewer_count %}
        <p class="mb-2">Reviewer 평점: {{ reviewer_rank }}</p> 
        <p class="mb-2">Reviewer 평점 참여자수: {{ reviewer_count }}</p> 
      {% else %}
        <p class="mb-2">Reviewer 평점: <span class="text-danger">아직 리뷰 데이터가 없습니다!<span></p> 
        <p class="mb-2">Reviewer 평점 참여자수: <span class="text-success">리뷰를 남겨주세요!<span></p> 
      {% endif %}
      {% if movie.youtube_path %} <!-- youtube path 있을 때만 렌더링 -->
        <iframe width="560" height="300" src="https://www.youtube.com/embed/{{ movie.youtube_path }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      {% endif %}
    </div>
  </div>
```



### ✔ view 함수 일부 수정 보완

- 영화 데이터가 아주 많지는 않아 페이지를 나누는 것이 크게 의미는 없다는 판단에 검색 기능에서 페이지네이터를 사용하지 않고 검색데이터가 전체적으로 보이도록 변경했고영화 줄거리에 키워드가 포함이 되어있을 때도 검색이 되도록 수정했습니다.
- 회원가입 / 회원정보 수정 / 비밀번호 수정시 프로필페이지로 리다이렉트되는 것이 자연스러운 것 같아 해당 부분을 반영했습니다.
- 메인페이지를 구현할때 queryset도 ".(번호)" 형식을 통해 데이터에 접근할 수 있다는 것을 몰라서 list로 변환했는데... 다시 테스트해보니 변환하지 않아도 접근이 가능하다는 것을 알게되어 이중으로 데이터를 가져오는 것보다는 한번만 가져오는 것이 적절한 것 같아 해당 부분을 수정했습니다.



### ✔ 오늘의 고민

```
고치고 나서 보면 또 고쳐야 할 것 같은 부분들이 나오고.. 기능에 영향을 주는 것은 아니지만 외부로 보이는 부분이라 기능 못지 않게 중요하고, 정답이 없기 때문에 front-end는 정말 어려운 것 같다.
이전에 배운 부트스트랩 기능들을 활용해 class를 적용해서 front 부분을 적용시켜 나기는 했는데, 일정이 타이트하다보니 어떤 페이지를 구성하는지에 대한 계획에 따라 진행되었다기보다는 일단 적용하는 것에 급하게 된 것이 아닌지 조금 아쉬움이 있었다.
메인페이지 구현을 위해 가져온 static한 css 파일이 미리 지정되어있는 설정이 전체 style에 영향을 주는 문제가 있어(특히 form 부분) 영향을 주는 일부 부분들을 주석처리해서 없애는 식으로 작업했다. 구현에 필요한 부분만 가져와서 사용할 수 있다면 좋을텐데 어느 부분이 필요한 부분인지 정확하게 판단하기가 어려워 일단 그대로 사용하기로 했다.
```

---

### ▶ 2021.11.25(목)

### ✔ 오늘의 계획

```
- 전체적인 front 보완 
	- 미흡하거나 편의적이지 않은 부분 보완 
- accounts : user 데이터 추가
- community : review, comment 데이터 추가
- movies : 한줄평 데이터 추가
- 추가적인 기능 고려
	- review 인덱스 페이지네이터 수정
	- 영화 데이터 정렬
	- 영화 추천 알고리즘
```



### ✔ Todo List

![image-20211125092549187](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125092549187.png)



### ✔ community index 페이지 네이터 반영

![image-20211125213846399](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125213846399.png)

- 커뮤니티 인덱스 페이지는 리뷰가  5개씩 보이도록 했고 paginator를 통해 이동할 수 있도록 구현했습니다.
- paginator는 django-bootstrap 기능을 이용하려고했는데 페이지네이터 색상을 바꾸지 못하는 단점이 있어서
- 일반 부트스트랩을 사용했고, 일반 부트스트랩도 색상은 파란색으로 한계가 있기 때문에 클래스를 지정해서 css파일을 수정하여 해결할 수 있었습니다~

```css
    <ul class="my pagination justify-content-center">
        <!-- 이전페이지 -->
        {% if reviews.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ reviews.previous_page_number }}">이전</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" tabindex="-1" aria-disabled="true" href="#">이전</a>
        </li>
        {% endif %}
        <!-- 페이지리스트 -->
        {% for page_number in reviews.paginator.page_range %}
            {% if page_number == reviews.number %}
            <li class="page-item active" aria-current="page">
                <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
            </li>
            {% else %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_number }}">{{ page_number }}</a>
            </li>
            {% endif %}
        {% endfor %}
        <!-- 다음페이지 -->
        {% if reviews.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ reviews.next_page_number }}">다음</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
        </li>
        {% endif %}
    </ul>
  
```

```css
.my.pagination > .page-item > a {
    color: white;
    background: grey;
    border-color: black
}
.my.pagination .disabled > a {
    background: black;
    color: white;
}
.my.pagination > .active > a, 
.my.pagination > .active > span {
    background: #4CAF50;   
} 
.my.pagination > .active > a:hover,
.my.pagination > .active > a:focus,
.my.pagination > .active > span:focus {
  background: rgb(200, 202, 49);
}
```



### ✔ movie list(All Movies) 정렬 기능 추가

![image-20211125211215607](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125211215607.png)

![image-20211125213524444](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125213524444.png)

- nav-bar에 movies 메뉴를 타고 들어가면 보이는 movie list는 페이지네이션을 활용하여 구현하였습니다.
- 제목순, 최신순, 인기순, 평점순, 스크랩 많은 순으로 정렬을 할 수 있도록 정렬 기능을 반영했습니다.
- 메인페이지 하단의 카드 배치와 동일한 배치를 활용했지만 메인페이지의 인피니트 스크롤 기능과 다르게 뒤쪽 페이지로도 쉽게 접근할 수 있도록 페이지네이터를 통해 페이지 이동을 할 수 있도록 구현했습니다.

```python
@require_safe
def movie_list(request, option):  
    if option == 1:
        movies = Movie.objects.order_by('title') 
    elif option == 2: # 최신순
        movies = Movie.objects.order_by('-release_date')
    elif option == 3: # 평점순
        movies = Movie.objects.order_by('-vote_average')
    elif option == 4: # 스크랩 많은 순
        movies = Movie.objects.annotate(scrap_count=Count('scrap_users')).order_by('-scrap_count', '-popularity')
    else: # 기본값은 인기순
        movies = Movie.objects.order_by('-popularity')

    paginator = Paginator(movies, 12) # 12개씩 잘라서 가져오기
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)

    context = {
        'movies': page_obj,
    }
    return render(request, 'movies/movie_list.html', context)
```

```html
<ul class="fw-bold">
    <li><a href="{% url 'movies:movie_list' 1 %}">제목순</a></li>
    <li><a href="{% url 'movies:movie_list' 2 %}">최신순</a></li>
    <li><a href="{% url 'movies:movie_list' 0 %}">인기순</a></li>
    <li><a href="{% url 'movies:movie_list' 3 %}">평점순</a></li>
    <li><a href="{% url 'movies:movie_list' 4 %}">스크랩 많은 순</a></li>
</ul>
```

```python
    path('movie_list/<int:option>/', views.movie_list, name='movie_list'),
```

- 마감시간이 가까워졌을 때 반영한 기능이라서 url으로 넘기는 파라미터값은 단순히 숫자로 지정을 했는데, 정렬하는 명칭으로 지정했다면 더 적절한 url이 되지 않았을까 하는 아쉬움이 약간 있었습니다. 그리고 url이 기존과 다르게 변경되면서 해당 링크로 이동하는 nav_bar와 movie detail 페이지에 작성된 back 링크로 인해 에러를 일으키는 문제가 있어서 수정을 했습니다!

- 처음에는 아래와 같이 select박스로 보내서 value값에 따라 정렬한 데이터를 보내는 방식을 사용했는데, 이 방식을 사용하니 페이지네이션을 구현하기 어려운 단점이 있었습니다. url 문제로 다음 페이지로 넘어갔을때 기존 데이터를 유지하지 않고 다시 기본 정렬을 하는 문제점을 해결하기 어려워서, 메인페이지에서 적용한 것 처럼 인피니트 스크롤로 구현했는데 아쉬움이 남았고, recomandation 페이지를 정렬하는 기능을 구현하다가 url로 파라미터를 보내는 방식을 적용하는 것이 더 적절하고, url을 유지하기때문에 페이지네이션도 반영하기가 쉽다는 것을 알게되어 적용할 수 있었습니다.

```html
  <div class="row-col-2 offset-10 mb-3 me-4">
    <select id="sort-select" class="form-select col-3" onchange="location = this.value;">
      <option class="default" value="/">------------</option>
      <option class="sort-popularity" value="?sort=popularity">인기순</option>
      <option class="sort-date" value="?sort=date">개봉일 최신순</option>
      <option class="sort-tmdb-rate" value="?sort=tmdb-rate">TMDB 평점순</option>
      <option class="sort-scraps" value="?sort=scraps">스크랩 많은순</option>
    </select>
  </div>
```



### ✔ movie recommedation 정렬 기능 추가

![image-20211125211159574](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125211159574.png)

- 영화 추천 알고리즘이 데이터베이스에서 랜덤으로 가져오는 기능과, tmdb 추천 데이터를 가져오는 두가지 기능이 있었는데,  두가지의 data type이 달라 정렬하는 과정에서 어려움을 겪었습니다. 
  - 데이터베이스에서 랜덤으로 가져오는 데이터는 objects타입으로 .order_by를 사용해서 정렬을 할 수 있는데, 문제점은 random.sample 함수를 통해 발생시킨 숫자 리스트가 정렬이 되어있지 않아서(말그대로 완전 랜덤!) 다시 정렬된 데이터의 순서가 뒤섞이는 문제가 있었습니다. 그래서 랜덤 숫자 리스트를 .sort()를 통해 정렬해서, 뒤섞인 랜덤 숫자가 아니라 정렬된 랜덤 숫자의 순서대로 출력할 수 있도록 해결을 할 수 있었습니다!
  - tmdb에서 가져오는 JSON데이터는 리스트 안에 딕셔너리가 들어있는 구조이기 때문에 sorted와 lambda를 사용하여 정렬을 할 수 있었습니다.
- 참조자료 : https://velog.io/@suasue/Django-%EC%A0%95%EB%A0%AC-%EB%BD%80%EA%B0%9C%EA%B8%B0-order-by-annotate-extra / 두가지 정렬에 대해 모두 내용이 잘 나와있어서 참조를 잘 할수 있었습니다! 

```python
@require_safe
def recommended(request, options):

    def real_random_movies(): # 가지고 있는 데이터 중에서 랜덤으로 10개 보여주는 함수
        if options:
            if options == 1:
                movies = Movie.objects.order_by('title')
            if options == 2:
                movies = Movie.objects.order_by('-release_date')
            if options == 3:
                movies = Movie.objects.order_by('-vote_average')
        else:
            movies = Movie.objects.order_by('-popularity')

        random_nums = random.sample(range(0, len(movies)), 12)
        random_nums.sort()
        for i in random_nums:
            random_movies.append(movies[i])
    
    def sort_tmdb(tmdb_movies):
        if options: # 제목순 # 개봉일순 # 평점순
            if options == 1:
                sorted_movies = sorted(tmdb_movies, key=lambda product: product['title'])
            elif options == 2:
                sorted_movies = sorted(tmdb_movies, key=lambda product: product['released_date'], reverse=True)
            elif options == 3:
                sorted_movies = sorted(tmdb_movies, key=lambda product: product['vote_average'], reverse=True)

        else: # 인기순
            sorted_movies = sorted(tmdb_movies, key=lambda product: product['popularity'], reverse=True)
        return sorted_movies

    random_movies = []
    tmdb_base = False

    if not request.user.is_authenticated or not request.user.scrap_movies.all(): # 로그인하지 않았거나 스크랩한 영화가 없을 때
        real_random_movies() # db 데이터에서 랜덤으로 10개 보여준다
    
    else: # 로그인 했고 스크랩한 영화가 있을 때
        try: # tmdb 요청시 에러 발생시
            random_num = random.randrange(0, request.user.scrap_movies.all().count()) # 스크랩한 영화의 인덱스 중에서 한개를 랜덤하게 가져온다
            random_movie_id = request.user.scrap_movies.all()[random_num].pk # 랜덤으로 가져온 인덱스 번호의 pk를 추출한다
            request_url = f'https://api.themoviedb.org/3/movie/{random_movie_id}/recommendations?api_key=e40e599e7176f5cb90028270852f4bf5&language=ko' # tmdb로 추천 영화 요청을 보낸다
            random_movies_info = requests.get(request_url).json()

            if random_movies_info['results']: # tmdb로 받은 추천 영화 데이터의 결과가 비어있지 않은 값이면
                random_movies = random_movies_info['results'] # tmdb 기준 추천 영화를 보여준다
                random_movies = sort_tmdb(random_movies)
                tmdb_base = True
            else: # tmdb 추천영화가 없을 때(results가 비어있을 때)
                real_random_movies() # db 데이터에서 랜덤으로 10개 보여준다
        except: # 에러 발생시 
            real_random_movies() # db 데이터에서 랜덤으로 10개 보여준다

    context = {
        'random_movies': random_movies,
        'tmdb_base': tmdb_base
    }
    return render(request, 'movies/recommended.html', context)

```

```html
  <ul class="fw-bold">
      <li><a class="active" href="{% url 'movies:recommended' 1 %}">제목순</a></li>
      <li><a href="{% url 'movies:recommended' 0 %}">인기순</a></li>
      <li><a href="{% url 'movies:recommended' 3 %}">평점순</a></li>
      <li><a href="{% url 'movies:recommended' 2 %}">최신순</a></li>
  </ul>
```

- movie list와 마찬가지로  URL 구성은 조금 아쉬운 부분이 있고, 다소 코드가 복잡해지기는 했지만, 그래도 추천페이지도 정렬한 데이터를 보여줄 수 있어서 뿌듯했습니다.😋



### ✔ form : text input area가 왜 작아졌을까...?👀

![image-20211126000507442](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211126000507442.png)

![image-20211125231959358](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125231959358.png)

![image-20211125231942300](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125231942300.png)

- 외부에서 가져온 css 파일의 설정(너비/색상이 미리 지정되어 있었음)으로 인해 검정색으로 나오는 문제가 있었는데

  검정색으로 나올때는 배경색에 가려져 미처 발견을 못했으나 너비가 줄어들어있는 문제가 있어 css 파일의 해당 부분을 주석처리하여 해결했습니다.



### ✔ accounts : user 정보 추가

![image-20211125210942004](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125210942004.png)

- admin도 프로필 페이지가 있습니다. admin의 프로필 접근은 일반 사용자는 불가하도록 view단에서 제한을 두어 staff권한이 있는 user만 접근이 가능합니다.
- 프로필 이미지를 등록하지 않은 경우에는 기본 이미지가 나오게 됩니다.

![image-20211125210927052](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125210927052.png)

- 과일을 테마로 유저 데이터를 등록했습니다!🍒🍇🥝🍉🍍

  

### ✔ movie : 한줄평 /  데이터 반영

![image-20211125211119255](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125211119255.png)

- movie detail 페이지 하단에 표시되는 한줄평과 영화에 리뷰를 등록해서 디테일페이지에서 리뷰를 모아볼 수 있도록 했습니다!

  

### ✔ review : 데이터 반영

![image-20211125211132377](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125211132377.png)

![image-20211125211616161](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125211616161.png)

- 등록한 리뷰와 사진은 위와 같이 표시되게 됩니다. 디테일페이지에서는 작성한 리뷰의 영화 정보 포스터와 링크를 클릭하면 영화 detail 페이지로 이동하게 됩니다.

  

### ✔ Todo list All Clear~!!🎉✨🎊

![image-20211125210059538](%EA%B0%9C%EB%B0%9C%EC%9D%BC%EC%A7%80/image-20211125210059538.png)

- 이렇게 해서 계획한 모든 기능을 구현했습니다😁❣